<div>
    <h2>Faculty List</h2>
    <button id="addFacultyButton">Add Faculty</button>

    <!-- Table to display faculty -->
    <table border="1" id="facultyTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Last Name</th>
                <th>First Name</th>
                <th>Contact</th>
                <th>Email</th>
                <th>Username</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- This will be dynamically filled via AJAX -->
        </tbody>
    </table>
</div>

<!-- Add Faculty Modal -->
<div id="addFacultyModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h3>Add Faculty</h3>
        <form id="addFacultyForm">
            <label for="lastname">Last Name:</label>
            <input type="text" id="lastname" name="lastname" required>

            <label for="firstname">First Name:</label>
            <input type="text" id="firstname" name="firstname" required>

            <label for="contact">Contact Number:</label>
            <input type="text" id="contact" name="contact" required>

            <label for="email">Email Address:</label>
            <input type="email" id="email" name="email" required>

            <label for="username">Username:</label>
            <input type="text" id="username" name="username" required>

            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required>

            <button type="submit">Submit</button>
        </form>
    </div>
</div>

<!-- Edit Faculty Modal -->
<div id="editFacultyModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h3>Edit Faculty</h3>
        <form id="editFacultyForm">
            <input type="hidden" id="editId" name="id">
        
            <label for="editLastname">Last Name:</label>
            <input type="text" id="editLastname" name="lastname" required>
        
            <label for="editFirstname">First Name:</label>
            <input type="text" id="editFirstname" name="firstname" required>
        
            <label for="editContact">Contact Number:</label>
            <input type="text" id="editContact" name="contact" required>
        
            <label for="editEmail">Email Address:</label>
            <input type="email" id="editEmail" name="email" required>
        
            <label for="editUsername">Username:</label>
            <input type="text" id="editUsername" name="username" required>
        
            <label for="editPassword">New Password (optional):</label>
            <input type="password" id="editPassword" name="password">
        
            <button type="submit">Update</button>
        </form>
    </div>
</div>

<style>
    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        padding-top: 100px;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.4);
    }

    .modal-content {
        background-color: #fefefe;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        width: 50%;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }
</style>

<script>
    const addModal = document.getElementById("addFacultyModal");
    const editModal = document.getElementById("editFacultyModal");

    document.getElementById("addFacultyButton").onclick = () => addModal.style.display = "block";

    document.querySelectorAll(".close").forEach(btn => {
        btn.onclick = () => {
            addModal.style.display = "none";
            editModal.style.display = "none";
        };
    });

    window.onclick = (event) => {
        if (event.target === addModal || event.target === editModal) {
            addModal.style.display = "none";
            editModal.style.display = "none";
        }
    };

    // Fetch and display faculty list
    const loadFaculty = async () => {
        const response = await fetch("/faculty/list");
        const faculty = await response.json();
        const tableBody = document.querySelector("#facultyTable tbody");
        tableBody.innerHTML = faculty.map(fac => `
            <tr>
                <td>${fac.id}</td>
                <td>${fac.lastname}</td>
                <td>${fac.firstname}</td>
                <td>${fac.contact}</td>
                <td>${fac.email}</td>
                <td>${fac.username}</td>
                <td>
                    <button onclick="openEditModal(${fac.id})">Edit</button>
                    <button onclick="deleteFaculty(${fac.id})">Delete</button>
                </td>
            </tr>
        `).join("");
    };

    loadFaculty();

    // Handle Add Faculty Form submission
    document.getElementById("addFacultyForm").onsubmit = async (event) => {
        event.preventDefault();
        const formData = new FormData(event.target);
        await fetch("/faculty", {
            method: "POST",
            body: formData
        });
        addModal.style.display = "none";
        loadFaculty();
    };

    // Open Edit Modal
    const openEditModal = async (id) => {
        const response = await fetch(`/faculty/${id}`);
        const faculty = await response.json();
        document.getElementById("editId").value = faculty.id;
        document.getElementById("editLastname").value = faculty.lastname;
        document.getElementById("editFirstname").value = faculty.firstname;
        document.getElementById("editContact").value = faculty.contact;
        document.getElementById("editEmail").value = faculty.email;
        document.getElementById("editUsername").value = faculty.username;
        editModal.style.display = "block";
    };

    // Handle Edit Faculty Form submission
    document.getElementById("editFacultyForm").onsubmit = async (event) => {
        event.preventDefault();
    
        const formData = new FormData(event.target);
        console.log("Form data being submitted:", Object.fromEntries(formData.entries())); // Debugging
    
        const response = await fetch(`/faculty/update/${formData.get("id")}`, {
            method: "POST",
            body: formData,
        });
    
        const result = await response.json();
    
        if (response.ok) {
            alert("Faculty updated successfully!");
            editModal.style.display = "none";
            loadFaculty();
        } else {
            alert(result.message || "Failed to update faculty.");
        }
    };
    


    // Delete Faculty
    const deleteFaculty = async (id) => {
        if (confirm("Are you sure you want to delete this faculty?")) {
            await fetch(`/faculty/${id}`, { method: "DELETE" });
            loadFaculty();
        }
    };
</script>
