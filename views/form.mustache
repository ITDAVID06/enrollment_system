<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enrollment Form</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="views/assets/css/form.css">
</head>
<body>
    <h1 class="text-center fs-4">CCS - Enrollment Form</h1>

    <!-- Success Message -->
    {{#session.success}}
    <p style="color: green;" class="text-center">{{session.success}}</p>
    {{/session.success}}

    <!-- Error Message -->
    {{#session.error}}
    <p style="color: red;" class="text-center">{{session.error}}</p>
    {{/session.error}}

    <form id="signUpForm" action="/enrollment" method="POST">
        <!-- Step indicators -->
        <div class="form-header d-flex mb-4">
            <span class="stepIndicator">Enrollment Information</span>
            <span class="stepIndicator">Review Information</span>
        </div>

        <!-- Step One: Enrollment Information -->
        <div class="step" id="step1">
            <p class="text-center mb-4">Enrollment Information</p>
            
            <!-- Status Dropdown -->
            <div class="mb-3">
                <label for="status" class="form-label">Status of Enrollee <span class="text-danger">*</span></label>
                <select id="status" class="form-select" name="status_id" required>
                    <option value="">Select Status</option>
                    {{#statuses}}
                    <option value="{{id}}">{{name}}</option>
                    {{/statuses}}
                </select>
            </div>

            <!-- Previous School Dropdown -->
            <div class="mb-3">
                <label for="previousSchool" class="form-label">Previous School <span class="text-danger">*</span></label>
                <select id="previousSchool" class="form-select" name="school_id" required>
                    <option value="">Select School</option>
                    {{#schools}}
                    <option value="{{id}}">{{name}}</option>
                    {{/schools}}
                </select>
            </div>

            <!-- Program Dropdown -->
            <div class="mb-3">
                <label for="program" class="form-label">Program Applying For <span class="text-danger">*</span></label>
                <select id="program" class="form-select" name="program_id" required>
                    <option value="">Select Program</option>
                    {{#programs}}
                    <option value="{{id}}">{{name}}</option>
                    {{/programs}}
                </select>
            </div>

            <!-- Year Level Dropdown -->
            <div class="mb-3">
                <label for="yearLevel" class="form-label">Year Level <span class="text-danger">*</span></label>
                <select id="yearLevel" class="form-select" name="year_level_id" required>
                    <option value="">Select Year Level</option>
                    {{#year_levels}}
                    <option value="{{id}}">{{level}}</option>
                    {{/year_levels}}
                </select>
            </div>

            <!-- Term Dropdown -->
            <div class="mb-3">
                <label for="term" class="form-label">Term <span class="text-danger">*</span></label>
                <select id="term" class="form-select" name="term_id" required>
                    <option value="">Select Term</option>
                    {{#terms}}
                    <option value="{{id}}">{{name}}</option>
                    {{/terms}}
                </select>
            </div>

            <!-- School Year Dropdown -->
            <div class="mb-3">
                <label for="schoolYear" class="form-label">School Year <span class="text-danger">*</span></label>
                <select id="schoolYear" class="form-select" name="school_year_id" required>
                    {{#school_years}}
                    <option value="{{id}}">{{year}}</option>
                    {{/school_years}}
                </select>
            </div>
        </div>

        <!-- Step Two: Review Information -->
        <div class="step" id="step2" style="display: none;">
            <p class="text-center mb-4" style="font-size: 1.5rem; font-weight: bold;">Review Your Information</p>

            <div class="mb-3">
                <label class="form-label">Status of Enrollee</label>
                <p id="reviewStatus"></p>
            </div>

            <div class="mb-3">
                <label class="form-label">Previous School</label>
                <p id="reviewSchool"></p>
            </div>

            <div class="mb-3">
                <label class="form-label">Program Applying For</label>
                <p id="reviewProgram"></p>
            </div>

            <div class="mb-3">
                <label class="form-label">Year Level</label>
                <p id="reviewYearLevel"></p>
            </div>

            <div class="mb-3">
                <label class="form-label">Term</label>
                <p id="reviewTerm"></p>
            </div>

            <div class="mb-3">
                <label class="form-label">School Year</label>
                <p id="reviewSchoolYear"></p>
            </div>
        </div>

        <!-- Step Footer: Navigation Buttons -->
        <div class="form-footer d-flex">
            <button type="button" id="prevBtn" onclick="nextPrev(-1)" class="btn btn-secondary me-2">Previous</button>
            <button type="button" id="nextBtn" onclick="nextPrev(1)" class="btn btn-primary">Next</button>
            <button type="button" id="submitBtn" class="btn btn-success" style="display: none;" onclick="showConfirmationModal()">Submit</button>
        </div>

                <!-- Success Message -->
        <div id="successMessage" style="display: none; color: green;">
            Successfully Submitted!
        </div>
    </form>

        <!-- Confirmation Modal -->
        <div class="modal" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="confirmationModalLabel">Confirm Submission</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="closeModal()"></button>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to submit this?</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button type="button" class="btn btn-primary" onclick="submitForm()">Yes</button>
                    </div>
                </div>
            </div>
        </div>
        
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>    
    <!-- External JavaScript files -->
    <script src="views/assets/js/form.js"></script>
    <script src="views/assets/js/location.js"></script>

    <script>
        var currentTab = 0; // Start at the first step
        
        function showTab(n) {
            // Show the current tab, and hide others
            var steps = document.querySelectorAll('.step');
            steps.forEach(function (step, index) {
                if (index === n) {
                    step.style.display = 'block'; // Show current tab
                } else {
                    step.style.display = 'none'; // Hide other tabs
                }
            });
    
            // Handle next/prev button visibility
            if (n === 0) {
                document.getElementById('prevBtn').style.display = 'none'; // No "prev" on the first step
            } else {
                document.getElementById('prevBtn').style.display = 'inline-block';
            }
    
            if (n === steps.length - 1) {
                document.getElementById('nextBtn').style.display = 'none'; // Hide "next" on last step
                document.getElementById('submitBtn').style.display = 'inline-block'; // Show submit button on last step
            } else {
                document.getElementById('nextBtn').style.display = 'inline-block';
                document.getElementById('submitBtn').style.display = 'none';
            }
    
            fixStepIndicator(n); // Update the step indicator
        }
    
        function nextPrev(n) {
            // Show next/prev tab
            var steps = document.querySelectorAll('.step');
            
            // Exit if any field in the current step is invalid
            if (n === 1 && !validateForm()) return false;

            // Transfer review data for step 1
            if (n === 1) {
                // Transfer selected data to review section
                document.getElementById('reviewStatus').textContent = document.getElementById('status').options[document.getElementById('status').selectedIndex].text;
                document.getElementById('reviewSchool').textContent = document.getElementById('previousSchool').options[document.getElementById('previousSchool').selectedIndex].text;
                document.getElementById('reviewProgram').textContent = document.getElementById('program').options[document.getElementById('program').selectedIndex].text;
                document.getElementById('reviewYearLevel').textContent = document.getElementById('yearLevel').options[document.getElementById('yearLevel').selectedIndex].text;
                document.getElementById('reviewTerm').textContent = document.getElementById('term').options[document.getElementById('term').selectedIndex].text;
                document.getElementById('reviewSchoolYear').textContent = document.getElementById('schoolYear').options[document.getElementById('schoolYear').selectedIndex].text;
            }

            // Hide the current tab and move to the next/previous one
            steps[currentTab].style.display = 'none';
            currentTab += n;

            if (currentTab >= steps.length) {
                document.getElementById('signUpForm').submit(); // Submit the form on last step
                return false;
            }

            showTab(currentTab); // Show the correct tab
            fixStepIndicator(currentTab); // Update step indicator for current tab
        }

        // Function to show the confirmation modal
        function showConfirmationModal() {
                var modal = new bootstrap.Modal(document.getElementById('confirmationModal'));
                modal.show();  // This triggers the modal to be shown
            }

        function closeModal() {
            var modalElement = document.getElementById('confirmationModal');
            // Use Bootstrap's Modal API to hide the modal
            var modalInstance = bootstrap.Modal.getInstance(modalElement);
            modalInstance.hide();
        }

            // Submit the form and show success message
            function submitForm() {
                // Hide the modal
                closeModal();

                // Simulate form submission (you can replace this with actual form submission)
                document.getElementById('signUpForm').submit();

                // Show success message
                document.getElementById('successMessage').style.display = 'block';

                // Optionally hide the success message after a few seconds
                setTimeout(function () {
                    document.getElementById('successMessage').style.display = 'none';
                }, 3000);  // Hide success message after 3 seconds
            }

        function fixStepIndicator(n) {
            var steps = document.querySelectorAll('.stepIndicator');
            steps.forEach(function (indicator, index) {
                indicator.classList.remove('active', 'finish'); // Remove both classes
                if (index <= n) {
                    indicator.classList.add('finish');
                }
            });
            steps[n].classList.add('active'); // Highlight the current step
        }
    
        function validateForm() {
            // Validate form fields here and return true if valid
            var currentStepFields = document.querySelectorAll('.step')[currentTab].querySelectorAll('input, select');
            var isValid = true;
            
            currentStepFields.forEach(function(field) {
                if (field.required && field.value === '') {
                    field.classList.add('is-invalid');
                    isValid = false;
                } else {
                    field.classList.remove('is-invalid');
                }
            });
    
            return isValid; // Return the validation status
        }
    
        // Function to clear danger notice on dropdown change
        function clearErrorNotice(event) {
            // Remove the error class if a valid selection is made
            if (event.target.value !== "") {
                event.target.classList.remove('is-invalid'); // Remove the invalid class
            }
        }
    
        // Attach event listeners to dropdowns to clear the error when an option is selected
        document.querySelectorAll('select').forEach(function(selectElement) {
            selectElement.addEventListener('change', clearErrorNotice);
        });
    
        // Initialize by showing the first tab and updating the step indicator
        showTab(currentTab);
    </script>
    
    

</body>
</html>
